<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IZIMMO ‚Äî Pipeline Acqu√©reurs</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Semi+Condensed:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --new-color: #00D2FF;
            --active-color: #7C4DFF;
            --bought-color: #00E676;
            --lost-color: #FF5252;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
            --border-color: #E1E8ED;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* ===== HEADER & NAVIGATION ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 30px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            font-family: 'Barlow Semi Condensed', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
        }

        .nav-tab {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.6);
            object-fit: cover;
        }

        .user-name {
            color: white;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .alert-counter {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .alert-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .alert-counter.has-alerts {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .alert-counter.has-alerts .alert-text { color: white; }

        .alert-counter.has-alerts .alert-icon { animation: ring 2s infinite; }

        @keyframes ring {
            0%, 100% { transform: rotate(0deg); }
            10%, 30% { transform: rotate(-10deg); }
            20%, 40% { transform: rotate(10deg); }
        }

        .alert-icon { font-size: 24px; }

        .alert-text {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: #667eea;
            transition: color 0.3s ease;
        }

        .alert-number {
            font-size: 20px;
            font-weight: 800;
            font-family: 'Barlow Semi Condensed', sans-serif;
        }

        .add-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-family: 'Inter', sans-serif;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* ===== PIPELINE ===== */
        .pipeline {
            display: grid;
            grid-template-columns: repeat(4, minmax(320px, 1fr));
            gap: 20px;
            overflow-x: auto;
            overflow-y: visible;
            padding-bottom: 20px;
            scroll-behavior: smooth;
        }

        .pipeline::-webkit-scrollbar { height: 12px; }
        .pipeline::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .pipeline::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 10px; }
        .pipeline::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }

        .column {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            min-height: 500px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .column-header {
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 12px;
            height: 200px;
        }

        .column-header img { width: 100%; height: 100%; object-fit: cover; }

        .column-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            font-family: 'Barlow Semi Condensed', sans-serif;
            font-size: 42px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
            font-style: italic;
        }

        .new-label { background: linear-gradient(135deg, rgba(0, 210, 255, 0.9) 0%, rgba(0, 184, 212, 0.7) 100%); }
        .active-label { background: linear-gradient(135deg, rgba(124, 77, 255, 0.9) 0%, rgba(98, 0, 234, 0.7) 100%); }
        .bought-label { background: linear-gradient(135deg, rgba(0, 230, 118, 0.9) 0%, rgba(0, 200, 83, 0.7) 100%); }
        .lost-label { background: linear-gradient(135deg, rgba(255, 82, 82, 0.9) 0%, rgba(213, 0, 0, 0.7) 100%); }

        .column-title {
            font-family: 'Barlow Semi Condensed', sans-serif;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 15px;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .column-count {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 200px;
        }

        /* ===== CARTES ACQU√âREURS ===== */
        .lead-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: grab;
            border: 2px solid transparent;
            animation: cardAppear 0.4s ease;
            position: relative;
        }

        @keyframes cardAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes highlight {
            0%, 100% { box-shadow: var(--shadow); }
            50% { box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.5), var(--shadow-hover); transform: scale(1.02); }
        }

        .lead-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .lead-card.dragging { opacity: 0.5; cursor: grabbing; }

        /* ===== BADGES ===== */
        .card-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-type-appartement { background: #E3F2FD; color: #1565C0; }
        .badge-type-maison { background: #FFF3E0; color: #E65100; }
        .badge-type-terrain { background: #E8F5E9; color: #2E7D32; }
        .badge-type-immeuble { background: #FCE4EC; color: #C2185B; }

        .badge-rooms { background: #F3E5F5; color: #7B1FA2; }
        .badge-sector { background: #E8EAF6; color: #283593; }
        .badge-budget { background: #FFF8E1; color: #F57F17; }

        .badge-seller {
            background: linear-gradient(135deg, #FF9800, #FF5722);
            color: white;
            animation: glowSeller 2s infinite;
        }

        @keyframes glowSeller {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 152, 0, 0.4); }
            50% { box-shadow: 0 0 15px rgba(255, 152, 0, 0.8); }
        }

        .card-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .card-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 6px;
            color: var(--text-dark);
        }

        .card-info {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .card-notes {
            font-size: 13px;
            color: var(--text-dark);
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            margin-top: 8px;
            line-height: 1.4;
            font-style: italic;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-links-count {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 6px;
        }

        .card-followup {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            margin-top: 8px;
            font-weight: 600;
        }

        .followup-ok { background: #d1f2eb; color: #0c5460; }
        .followup-due { background: #fff3cd; color: #856404; }
        .followup-overdue { background: #f8d7da; color: #721c24; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .badge-alert {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: pulse 2s infinite;
        }

        .card-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 10px;
        }

        .card-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            color: var(--text-light);
            transition: color 0.2s ease;
            font-size: 18px;
        }

        .card-btn:hover { color: var(--text-dark); }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            margin: 20px auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-family: 'Barlow Semi Condensed', sans-serif;
            font-size: 28px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--text-dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s ease;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover { color: var(--text-dark); }

        .form-section {
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .form-section:last-child { border-bottom: none; }

        .form-section-title {
            font-family: 'Barlow Semi Condensed', sans-serif;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            color: #667eea;
            margin-bottom: 16px;
            letter-spacing: 0.5px;
        }

        .form-group { margin-bottom: 20px; }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea { resize: vertical; min-height: 80px; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }

        /* Crit√®res toggles */
        .criteria-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .criteria-toggle input { display: none; }

        .criteria-toggle span {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .criteria-toggle input:checked + span {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .criteria-toggle span:hover {
            border-color: #667eea;
        }

        /* Toggle switch vendeur */
        .seller-toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle-switch input { display: none; }

        .toggle-slider {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #ccc;
            border-radius: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #FF9800, #FF5722);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        .seller-fields {
            background: #FFF3E0;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
            border: 2px solid #FFE0B2;
        }

        /* Section liens */
        .links-section { margin-top: 12px; }

        .link-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 10px 14px;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .link-platform {
            font-size: 18px;
            flex-shrink: 0;
        }

        .link-url {
            flex: 1;
            font-size: 13px;
            color: #667eea;
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .link-status-select {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            background: white;
        }

        .link-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: var(--text-light);
            transition: color 0.2s;
        }

        .link-delete-btn:hover { color: #FF5252; }

        .add-link-row {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .add-link-row input {
            flex: 1;
            padding: 10px 14px;
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
        }

        .add-link-row input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-link-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .add-link-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
            font-family: 'Barlow Semi Condensed', sans-serif;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .pipeline { grid-template-columns: 1fr; }
            .form-row, .form-row-3 { grid-template-columns: 1fr; }
            .logo { font-size: 20px; }
            .modal-content { padding: 24px; }
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .nav-tabs { order: 1; }
            .header-actions { flex-direction: column; width: 100%; order: 2; }
            .alert-counter { width: 100%; justify-content: center; }
            .add-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="logo">IZIMMO</a>
        <nav class="nav-tabs">
            <a href="index.html" class="nav-tab">üè† Pipeline Vendeurs</a>
            <a href="acquereurs.html" class="nav-tab active">üîë Pipeline Acqu√©reurs</a>
        </nav>
        <div class="header-actions">
            <div id="userProfile" class="user-profile"></div>
            <div class="alert-counter" id="alertCounter">
                <span class="alert-icon">üîî</span>
                <span class="alert-text">
                    <span class="alert-number" id="alertNumber">0</span> √† relancer
                </span>
            </div>
            <button class="add-btn" id="addBuyerBtn">+ Ajouter un Acqu√©reur</button>
        </div>
    </div>

    <div class="pipeline">
        <!-- Colonne Nouveaux Acqu√©reurs -->
        <div class="column" data-status="new">
            <div class="column-header">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Cdefs%3E%3ClinearGradient id='g1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300E5FF'/%3E%3Cstop offset='100%25' style='stop-color:%2300D2FF'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='400' fill='url(%23g1)'/%3E%3Cpath d='M0,200 Q200,150 400,200 T800,200 L800,400 L0,400 Z' fill='%2300B8D4' opacity='0.5'/%3E%3C/svg%3E" alt="Nouveaux">
                <div class="column-label new-label">NOUVEAUX</div>
            </div>
            <div class="column-title">Premier contact</div>
            <div class="column-count"><span>üìã</span><span class="count">0</span></div>
            <div class="cards-container" id="new-container"></div>
        </div>

        <!-- Colonne En Recherche Active -->
        <div class="column" data-status="active">
            <div class="column-header">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Cdefs%3E%3ClinearGradient id='g2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23B388FF'/%3E%3Cstop offset='100%25' style='stop-color:%237C4DFF'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='400' fill='url(%23g2)'/%3E%3Cpath d='M0,250 Q200,200 400,250 T800,250 L800,400 L0,400 Z' fill='%236200EA' opacity='0.5'/%3E%3C/svg%3E" alt="Recherche Active">
                <div class="column-label active-label">RECHERCHE ACTIVE</div>
            </div>
            <div class="column-title">Crit√®res d√©finis, envoi de biens</div>
            <div class="column-count"><span>üìã</span><span class="count">0</span></div>
            <div class="cards-container" id="active-container"></div>
        </div>

        <!-- Colonne Achet√©s -->
        <div class="column" data-status="bought">
            <div class="column-header">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Cdefs%3E%3ClinearGradient id='g3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2369F0AE'/%3E%3Cstop offset='100%25' style='stop-color:%2300E676'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='400' fill='url(%23g3)'/%3E%3Cpath d='M0,220 Q200,170 400,220 T800,220 L800,400 L0,400 Z' fill='%2300C853' opacity='0.5'/%3E%3C/svg%3E" alt="Achet√©s">
                <div class="column-label bought-label">ACHET√âS</div>
            </div>
            <div class="column-title">Ils ont trouv√© üéâ</div>
            <div class="column-count"><span>üìã</span><span class="count">0</span></div>
            <div class="cards-container" id="bought-container"></div>
        </div>

        <!-- Colonne Perdus -->
        <div class="column" data-status="lost">
            <div class="column-header">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Cdefs%3E%3ClinearGradient id='g4' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23FF8A80'/%3E%3Cstop offset='100%25' style='stop-color:%23FF5252'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='400' fill='url(%23g4)'/%3E%3Cpath d='M0,260 Q200,210 400,260 T800,260 L800,400 L0,400 Z' fill='%23D50000' opacity='0.5'/%3E%3C/svg%3E" alt="Perdus">
                <div class="column-label lost-label">PERDUS</div>
            </div>
            <div class="column-title">Abandon</div>
            <div class="column-count"><span>üìã</span><span class="count">0</span></div>
            <div class="cards-container" id="lost-container"></div>
        </div>
    </div>

    <!-- Modal Acqu√©reur -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nouvel Acqu√©reur</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <form id="buyerForm">
                <!-- Section Contact -->
                <div class="form-section">
                    <div class="form-section-title">üìá Contact</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-input" id="firstName" placeholder="Jean" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nom *</label>
                            <input type="text" class="form-input" id="lastName" placeholder="Dupont" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-input" id="phone" placeholder="06 12 34 56 78">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="email" placeholder="jean@email.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Source du lead</label>
                            <select class="form-select" id="source">
                                <option value="">S√©lectionnez</option>
                                <option value="site_annonce">üåê Site d'annonce (SL, LBC, BienIci)</option>
                                <option value="efficity">üè¢ Efficity</option>
                                <option value="recommandation">ü§ù Recommandation</option>
                                <option value="appel_entrant">üìû Appel entrant</option>
                                <option value="reseaux_sociaux">üì± R√©seaux sociaux</option>
                                <option value="autre">üìå Autre</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section Recherche -->
                <div class="form-section">
                    <div class="form-section-title">üîç Recherche</div>
                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">Type de bien *</label>
                            <select class="form-select" id="propertyType" required>
                                <option value="">S√©lectionnez</option>
                                <option value="appartement">Appartement</option>
                                <option value="maison">Maison</option>
                                <option value="terrain">Terrain</option>
                                <option value="immeuble">Immeuble</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Typologie</label>
                            <select class="form-select" id="rooms">
                                <option value="">‚Äî</option>
                                <option value="T1">T1</option>
                                <option value="T2">T2</option>
                                <option value="T3">T3</option>
                                <option value="T4">T4</option>
                                <option value="T5+">T5+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Surface min (m¬≤)</label>
                            <input type="number" class="form-input" id="surfaceMin" placeholder="60">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Secteur / Villes *</label>
                        <input type="text" class="form-input" id="sector" placeholder="Lyon 3, Villeurbanne..." required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Budget min (‚Ç¨)</label>
                            <input type="number" class="form-input" id="budgetMin" placeholder="200000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Budget max (‚Ç¨)</label>
                            <input type="number" class="form-input" id="budgetMax" placeholder="350000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Crit√®res</label>
                        <div class="criteria-toggles">
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="jardin"><span>üåø Jardin</span></label>
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="parking"><span>üÖøÔ∏è Parking</span></label>
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="ascenseur"><span>üõó Ascenseur</span></label>
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="balcon_terrasse"><span>‚òÄÔ∏è Balcon/Terrasse</span></label>
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="calme"><span>ü§´ Calme</span></label>
                            <label class="criteria-toggle"><input type="checkbox" name="criteria" value="neuf_renove"><span>‚ú® Neuf/R√©nov√©</span></label>
                        </div>
                    </div>
                </div>

                <!-- Section Situation -->
                <div class="form-section">
                    <div class="form-section-title">üìä Situation</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pr√©-accord bancaire</label>
                            <select class="form-select" id="bankApproval">
                                <option value="">‚Äî</option>
                                <option value="oui">‚úÖ Oui</option>
                                <option value="non">‚ùå Non</option>
                                <option value="en_cours">‚è≥ En cours</option>
                                <option value="ne_sait_pas">‚ùì Ne sait pas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">D√©lai projet</label>
                            <select class="form-select" id="timeline">
                                <option value="">‚Äî</option>
                                <option value="immediat">üöÄ Imm√©diat</option>
                                <option value="court_terme">üìÖ Court terme (1-3 mois)</option>
                                <option value="moyen_terme">üìÜ Moyen terme (3-6 mois)</option>
                                <option value="long_terme">üóìÔ∏è Long terme (6 mois+)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="seller-toggle-group">
                            <label class="toggle-switch">
                                <input type="checkbox" id="isSeller">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="font-weight:600;font-size:14px;">üè∑Ô∏è Ce prospect est aussi vendeur d'un bien</span>
                        </div>
                        <div class="seller-fields" id="sellerFields" style="display:none;">
                            <div class="form-group" style="margin-bottom:12px;">
                                <label class="form-label">Adresse du bien √† vendre</label>
                                <input type="text" class="form-input" id="sellerAddress" placeholder="123 rue de la Paix, Lyon">
                            </div>
                            <div class="form-group" style="margin-bottom:0;">
                                <label class="form-label">Prix de vente souhait√©</label>
                                <input type="text" class="form-input" id="sellerPrice" placeholder="350 000 ‚Ç¨">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Notes -->
                <div class="form-section">
                    <div class="form-section-title">üìù Notes</div>
                    <div class="form-group">
                        <label class="form-label">√âl√©ments r√©dhibitoires</label>
                        <textarea class="form-textarea" id="dealbreakers" placeholder="Pas de rez-de-chauss√©e, pas proche voie ferr√©e..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes libres</label>
                        <textarea class="form-textarea" id="notes" placeholder="Informations compl√©mentaires..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date de relance</label>
                            <input type="date" class="form-input" id="reminder">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Colonne</label>
                            <select class="form-select" id="status">
                                <option value="new">üÜï Nouveaux Acqu√©reurs</option>
                                <option value="active">üîç En Recherche Active</option>
                                <option value="bought">üéâ Achet√©s</option>
                                <option value="lost">‚ùå Perdus</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section Biens Propos√©s -->
                <div class="form-section">
                    <div class="form-section-title">üè† Biens Propos√©s</div>
                    <div class="links-section" id="linksContainer"></div>
                    <div class="add-link-row">
                        <input type="url" id="newLinkUrl" placeholder="Coller l'URL d'une annonce..." class="form-input">
                        <button type="button" class="add-link-btn" id="addLinkBtn">+ Ajouter</button>
                    </div>
                </div>

                <button type="button" class="submit-btn" id="submitBtn">Cr√©er l'Acqu√©reur</button>
            </form>
        </div>
    </div>

    <script>
        // ===== DONN√âES =====
        let buyers = [];
        let currentLinks = [];
        let draggedCard = null;

        // ===== CONFIG BADGES =====
        const TYPE_CONFIG = {
            appartement: { label: 'Appart.', icon: 'üè¢', cls: 'badge-type-appartement' },
            maison: { label: 'Maison', icon: 'üè°', cls: 'badge-type-maison' },
            terrain: { label: 'Terrain', icon: 'üå≥', cls: 'badge-type-terrain' },
            immeuble: { label: 'Immeuble', icon: 'üèõÔ∏è', cls: 'badge-type-immeuble' }
        };

        // ===== HELPERS =====
        function formatBudget(min, max) {
            const fmt = (n) => {
                n = parseInt(n);
                if (n >= 1000000) return (n / 1000000).toFixed(1).replace('.0', '') + 'M';
                if (n >= 1000) return Math.round(n / 1000) + 'k';
                return n.toString();
            };
            if (min && max) return fmt(min) + '-' + fmt(max) + '‚Ç¨';
            if (max) return '< ' + fmt(max) + '‚Ç¨';
            if (min) return '> ' + fmt(min) + '‚Ç¨';
            return '';
        }

        function detectPlatform(url) {
            if (url.includes('seloger.com')) return { name: 'SeLoger', icon: 'üè†' };
            if (url.includes('leboncoin.fr')) return { name: 'LeBonCoin', icon: 'üü†' };
            if (url.includes('bienici.com')) return { name: 'BienIci', icon: 'üîµ' };
            if (url.includes('efficity.com')) return { name: 'Efficity', icon: 'üè¢' };
            if (url.includes('logic-immo.com')) return { name: 'Logic-Immo', icon: 'üèòÔ∏è' };
            if (url.includes('pap.fr')) return { name: 'PAP', icon: 'üì∞' };
            return { name: 'Lien', icon: 'üîó' };
        }

        function getFollowupHTML(reminder) {
            if (!reminder) return { html: '', isAlert: false };
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const reminderDate = new Date(reminder);
            reminderDate.setHours(0, 0, 0, 0);
            const diffDays = Math.ceil((reminderDate - today) / (1000 * 60 * 60 * 24));
            const formatted = reminderDate.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });

            if (diffDays < 0) return { html: `<div class="card-followup followup-overdue">‚ö†Ô∏è Relance en retard (${formatted})</div>`, isAlert: true };
            if (diffDays === 0) return { html: `<div class="card-followup followup-due">üîî √Ä relancer aujourd'hui</div>`, isAlert: true };
            if (diffDays <= 3) return { html: `<div class="card-followup followup-due">üìÖ Relance ${formatted}</div>`, isAlert: false };
            return { html: `<div class="card-followup followup-ok">üìÖ Relance ${formatted}</div>`, isAlert: false };
        }

        // ===== SUPABASE CRUD =====
        async function loadBuyers() {
            const { data, error } = await supabaseClient
                .from('buyers')
                .select('*')
                .order('created_at', { ascending: false });
            if (error) { console.error('Erreur chargement:', error); return; }
            buyers = data || [];
            renderBuyers();
        }

        async function createBuyer(buyer) {
            const { data, error } = await supabaseClient.from('buyers').insert([buyer]).select();
            if (error) { console.error('Erreur cr√©ation:', error); alert('Erreur lors de la cr√©ation.'); return null; }
            return data[0];
        }

        async function updateBuyer(id, updates) {
            updates.updated_at = new Date().toISOString();
            const { data, error } = await supabaseClient.from('buyers').update(updates).eq('id', id).select();
            if (error) { console.error('Erreur mise √† jour:', error); alert('Erreur lors de la mise √† jour.'); return null; }
            return data[0];
        }

        async function deleteBuyerDB(id) {
            const { error } = await supabaseClient.from('buyers').delete().eq('id', id);
            if (error) { console.error('Erreur suppression:', error); alert('Erreur lors de la suppression.'); return false; }
            return true;
        }

        // ===== RENDU =====
        function renderBuyers() {
            const containers = {
                new: document.getElementById('new-container'),
                active: document.getElementById('active-container'),
                bought: document.getElementById('bought-container'),
                lost: document.getElementById('lost-container')
            };

            Object.values(containers).forEach(c => { if (c) c.innerHTML = ''; });

            buyers.forEach(buyer => {
                const card = createBuyerCard(buyer);
                if (containers[buyer.status]) {
                    containers[buyer.status].appendChild(card);
                }
            });

            updateCounts();
        }

        function createBuyerCard(buyer) {
            const card = document.createElement('div');
            card.className = 'lead-card';
            card.draggable = true;
            card.dataset.id = buyer.id;

            const followup = getFollowupHTML(buyer.reminder);
            let html = '';

            if (followup.isAlert) {
                html += '<div class="badge-alert">√Ä RELANCER</div>';
            }

            // Badges visuels
            html += '<div class="card-badges">';
            if (buyer.property_type) {
                const tc = TYPE_CONFIG[buyer.property_type];
                if (tc) html += `<span class="badge ${tc.cls}">${tc.icon} ${tc.label}</span>`;
            }
            if (buyer.rooms) {
                html += `<span class="badge badge-rooms">${buyer.rooms}</span>`;
            }
            if (buyer.sector) {
                html += `<span class="badge badge-sector">üìç ${buyer.sector}</span>`;
            }
            const budgetLabel = formatBudget(buyer.budget_min, buyer.budget_max);
            if (budgetLabel) {
                html += `<span class="badge badge-budget">üí∞ ${budgetLabel}</span>`;
            }
            if (buyer.is_seller) {
                html += '<span class="badge badge-seller">üè∑Ô∏è Vendeur</span>';
            }
            html += '</div>';

            // Source tag
            if (buyer.source) {
                html += getBuyerSourceTag(buyer.source);
            }

            // Infos principales
            html += `<div class="card-name">${buyer.first_name} ${buyer.last_name}</div>`;
            if (buyer.phone) html += `<div class="card-info">üìû ${buyer.phone}</div>`;
            if (buyer.email) html += `<div class="card-info">üìß ${buyer.email}</div>`;

            // Notes
            if (buyer.notes) {
                html += `<div class="card-notes">üí¨ ${buyer.notes}</div>`;
            }

            // Compteur de liens
            const links = buyer.links || [];
            if (links.length > 0) {
                html += `<div class="card-links-count">üè† ${links.length} bien${links.length > 1 ? 's' : ''} propos√©${links.length > 1 ? 's' : ''}</div>`;
            }

            // Relance
            html += followup.html;

            // Actions
            html += `<div class="card-actions">
                <button class="card-btn" onclick="editBuyer('${buyer.id}')" title="Modifier">‚úèÔ∏è</button>
                <button class="card-btn" onclick="confirmDeleteBuyer('${buyer.id}')" title="Supprimer">üóëÔ∏è</button>
            </div>`;

            card.innerHTML = html;
            return card;
        }

        function updateCounts() {
            const statuses = ['new', 'active', 'bought', 'lost'];
            statuses.forEach(status => {
                const count = buyers.filter(b => b.status === status).length;
                const col = document.querySelector(`.column[data-status="${status}"] .count`);
                if (col) col.textContent = count;
            });
            updateAlertCounter();
        }

        function updateAlertCounter() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const count = buyers.filter(b => {
                if (!b.reminder) return false;
                const d = new Date(b.reminder);
                d.setHours(0, 0, 0, 0);
                return d <= today;
            }).length;

            document.getElementById('alertNumber').textContent = count;
            const el = document.getElementById('alertCounter');
            if (count > 0) el.classList.add('has-alerts');
            else el.classList.remove('has-alerts');
        }

        // ===== MODAL =====
        function openModal() {
            document.getElementById('modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.body.style.overflow = 'auto';
            resetForm();
        }

        function resetForm() {
            document.getElementById('buyerForm').reset();
            document.getElementById('sellerFields').style.display = 'none';
            currentLinks = [];
            renderLinks();
            const btn = document.getElementById('submitBtn');
            delete btn.dataset.editId;
            btn.textContent = "Cr√©er l'Acqu√©reur";
            document.querySelector('.modal-title').textContent = 'Nouvel Acqu√©reur';
        }

        // ===== LIENS =====
        function renderLinks() {
            const container = document.getElementById('linksContainer');
            container.innerHTML = '';
            currentLinks.forEach((link, i) => {
                const platform = detectPlatform(link.url);
                const item = document.createElement('div');
                item.className = 'link-item';
                item.innerHTML = `
                    <span class="link-platform">${platform.icon}</span>
                    <a href="${link.url}" target="_blank" class="link-url" title="${link.url}">${platform.name}: ${link.url.replace(/https?:\/\/(www\.)?/, '').substring(0, 40)}...</a>
                    <select class="link-status-select" data-index="${i}" onchange="updateLinkStatus(${i}, this.value)">
                        <option value="proposed" ${link.status === 'proposed' ? 'selected' : ''}>üì§ Propos√©</option>
                        <option value="visited" ${link.status === 'visited' ? 'selected' : ''}>üëÄ Visit√©</option>
                        <option value="interested" ${link.status === 'interested' ? 'selected' : ''}>‚ù§Ô∏è Int√©ress√©</option>
                        <option value="refused" ${link.status === 'refused' ? 'selected' : ''}>üëé Refus√©</option>
                    </select>
                    <button class="link-delete-btn" onclick="removeLink(${i})">üóëÔ∏è</button>
                `;
                container.appendChild(item);
            });
        }

        function addLink() {
            const input = document.getElementById('newLinkUrl');
            const url = input.value.trim();
            if (!url) return;
            currentLinks.push({ url, status: 'proposed', added_at: new Date().toISOString().split('T')[0] });
            input.value = '';
            renderLinks();
        }

        function updateLinkStatus(index, status) {
            if (currentLinks[index]) currentLinks[index].status = status;
        }

        function removeLink(index) {
            currentLinks.splice(index, 1);
            renderLinks();
        }

        // ===== EDIT =====
        function editBuyer(id) {
            const buyer = buyers.find(b => b.id === id);
            if (!buyer) return;

            document.getElementById('firstName').value = buyer.first_name || '';
            document.getElementById('lastName').value = buyer.last_name || '';
            document.getElementById('phone').value = buyer.phone || '';
            document.getElementById('email').value = buyer.email || '';
            document.getElementById('source').value = buyer.source || '';
            document.getElementById('propertyType').value = buyer.property_type || '';
            document.getElementById('rooms').value = buyer.rooms || '';
            document.getElementById('surfaceMin').value = buyer.surface_min || '';
            document.getElementById('sector').value = buyer.sector || '';
            document.getElementById('budgetMin').value = buyer.budget_min || '';
            document.getElementById('budgetMax').value = buyer.budget_max || '';
            document.getElementById('bankApproval').value = buyer.bank_approval || '';
            document.getElementById('timeline').value = buyer.timeline || '';
            document.getElementById('dealbreakers').value = buyer.dealbreakers || '';
            document.getElementById('notes').value = buyer.notes || '';
            document.getElementById('reminder').value = buyer.reminder || '';
            document.getElementById('status').value = buyer.status || 'new';

            // Crit√®res
            document.querySelectorAll('input[name="criteria"]').forEach(cb => {
                cb.checked = (buyer.criteria || []).includes(cb.value);
            });

            // Vendeur toggle
            const isSeller = buyer.is_seller || false;
            document.getElementById('isSeller').checked = isSeller;
            document.getElementById('sellerFields').style.display = isSeller ? 'block' : 'none';
            document.getElementById('sellerAddress').value = buyer.seller_address || '';
            document.getElementById('sellerPrice').value = buyer.seller_price || '';

            // Liens
            currentLinks = JSON.parse(JSON.stringify(buyer.links || []));
            renderLinks();

            // Mode √©dition
            const btn = document.getElementById('submitBtn');
            btn.dataset.editId = id;
            btn.textContent = 'Mettre √† jour';
            document.querySelector('.modal-title').textContent = "Modifier l'Acqu√©reur";

            openModal();
        }

        async function confirmDeleteBuyer(id) {
            if (!confirm('Supprimer cet acqu√©reur ?')) return;
            const ok = await deleteBuyerDB(id);
            if (ok) {
                buyers = buyers.filter(b => b.id !== id);
                renderBuyers();
            }
        }

        // ===== SOUMISSION =====
        async function handleSubmit() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const propertyType = document.getElementById('propertyType').value;
            const sector = document.getElementById('sector').value.trim();

            if (!firstName || !lastName || !propertyType || !sector) {
                alert('Veuillez remplir les champs obligatoires (*)');
                return;
            }

            const criteria = Array.from(document.querySelectorAll('input[name="criteria"]:checked')).map(cb => cb.value);

            const buyerData = {
                first_name: firstName,
                last_name: lastName,
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                source: document.getElementById('source').value || null,
                property_type: propertyType,
                rooms: document.getElementById('rooms').value || null,
                sector,
                surface_min: parseInt(document.getElementById('surfaceMin').value) || null,
                budget_min: parseInt(document.getElementById('budgetMin').value) || null,
                budget_max: parseInt(document.getElementById('budgetMax').value) || null,
                criteria,
                bank_approval: document.getElementById('bankApproval').value || null,
                timeline: document.getElementById('timeline').value || null,
                is_seller: document.getElementById('isSeller').checked,
                seller_address: document.getElementById('sellerAddress').value.trim() || null,
                seller_price: document.getElementById('sellerPrice').value.trim() || null,
                dealbreakers: document.getElementById('dealbreakers').value.trim() || null,
                notes: document.getElementById('notes').value.trim() || null,
                reminder: document.getElementById('reminder').value || null,
                status: document.getElementById('status').value,
                links: currentLinks
            };

            const editId = document.getElementById('submitBtn').dataset.editId;

            if (editId) {
                const updated = await updateBuyer(editId, buyerData);
                if (updated) {
                    const idx = buyers.findIndex(b => b.id === editId);
                    if (idx !== -1) buyers[idx] = updated;
                }
            } else {
                const created = await createBuyer(buyerData);
                if (created) buyers.unshift(created);
            }

            renderBuyers();
            closeModal();
        }

        // ===== DRAG & DROP =====
        function setupDragAndDrop() {
            document.addEventListener('dragstart', e => {
                if (e.target.classList.contains('lead-card')) {
                    draggedCard = e.target;
                    e.target.classList.add('dragging');
                }
            });

            document.addEventListener('dragend', e => {
                if (e.target.classList.contains('lead-card')) {
                    e.target.classList.remove('dragging');
                }
            });

            document.querySelectorAll('.cards-container').forEach(container => {
                container.addEventListener('dragover', e => e.preventDefault());

                container.addEventListener('drop', async e => {
                    e.preventDefault();
                    if (!draggedCard) return;

                    const buyerId = draggedCard.dataset.id;
                    const newStatus = container.closest('.column').dataset.status;
                    const buyer = buyers.find(b => b.id === buyerId);

                    if (buyer && buyer.status !== newStatus) {
                        buyer.status = newStatus;
                        await updateBuyer(buyerId, { status: newStatus });
                        renderBuyers();
                    }
                });
            });
        }

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', () => {
            loadBuyers();
            setupDragAndDrop();

            document.getElementById('addBuyerBtn').addEventListener('click', openModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
            document.getElementById('addLinkBtn').addEventListener('click', addLink);

            // Entr√©e pour ajouter un lien
            document.getElementById('newLinkUrl').addEventListener('keydown', e => {
                if (e.key === 'Enter') { e.preventDefault(); addLink(); }
            });

            // Toggle vendeur
            document.getElementById('isSeller').addEventListener('change', function() {
                document.getElementById('sellerFields').style.display = this.checked ? 'block' : 'none';
            });

            // Fermer modal
            document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
            document.getElementById('modal').addEventListener('click', e => { if (e.target === e.currentTarget) closeModal(); });

            // Clic alertes
            document.getElementById('alertCounter').addEventListener('click', () => {
                const cards = document.querySelectorAll('.lead-card');
                for (let card of cards) {
                    if (card.querySelector('.badge-alert')) {
                        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        card.style.animation = 'none';
                        setTimeout(() => { card.style.animation = 'highlight 1s ease'; }, 10);
                        break;
                    }
                }
            });
        });
    </script>
</body>
</html>
